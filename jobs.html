<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CareerCompass – Jobs</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* === THEME VARIABLES (match your home page) === */
    :root {
      --primary-purple: #8b5cf6;
      --primary-cyan: #06b6d4;
      --primary-magenta: #ec4899;
      --neon-purple: #a855f7;
      --neon-cyan: #22d3ee;
      --neon-magenta: #f472b6;
      --dark-bg: #0a0a0f;
      --dark-surface: #1a1a2e;
      --glass-bg: rgba(255, 255, 255, 0.05);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text-primary: #ffffff;
      --text-secondary: #a1a1aa;
      --font-heading: 'Orbitron', monospace;
      --font-body: 'Poppins', sans-serif;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; }
    body { font-family: var(--font-body); background: var(--dark-bg); color: var(--text-primary); line-height: 1.6; overflow-x: hidden; }

    /* Animated background */
    .bg-animation { position: fixed; inset: 0; z-index: -1; background:
      radial-gradient(circle at 15% 35%, rgba(139, 92, 246, 0.25), transparent 50%),
      radial-gradient(circle at 85% 25%, rgba(6, 182, 212, 0.25), transparent 50%),
      radial-gradient(circle at 50% 80%, rgba(236, 72, 153, 0.2), transparent 50%),
      linear-gradient(135deg, var(--dark-bg) 0%, #0f0f1a 100%);
      animation: gradientShift 16s ease-in-out infinite; }
    @keyframes gradientShift { 0%,100%{ transform: translate(0) rotate(0deg)} 25%{ transform: translate(-15px, -10px) rotate(0.5deg)} 50%{ transform: translate(12px, -6px) rotate(-0.5deg)} 75%{ transform: translate(-6px, 12px) rotate(0.25deg)} }

    /* Utilities */
    .glass { background: var(--glass-bg); border: 1px solid var(--glass-border); backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); }

    /* Navbar */
    .navbar { position: sticky; top: 0; z-index: 1000; padding: 1rem 1.25rem; transition: all .3s ease; }
    .navbar.scrolled { background: rgba(10,10,15,.9); backdrop-filter: blur(18px); border-bottom: 1px solid var(--glass-border); }
    .nav-wrap { max-width: 1200px; margin: 0 auto; display: flex; align-items: center; justify-content: space-between; }
    .logo { font-family: var(--font-heading); font-weight: 900; font-size: 1.45rem; letter-spacing:.5px; background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-decoration: none; }
    .nav-links { display: flex; gap: 1.5rem; list-style: none; }
    .nav-links a { color: var(--text-secondary); text-decoration: none; font-weight: 500; padding:.5rem .75rem; border-radius: .5rem; transition: all .2s ease; position: relative; }
    .nav-links a:hover { color: var(--text-primary); background: var(--glass-bg); border: 1px solid var(--glass-border); box-shadow: 0 0 18px rgba(34,211,238,.25); transform: translateY(-2px); }
    .nav-links a.active { color: var(--text-primary); }
    .mobile-menu-btn { display:none; font-size:1.6rem; color:var(--text-primary); background:none; border:0; cursor:pointer; }

    /* Hero */
    .hero { padding: 5rem 1.25rem 2rem; display:flex; align-items:center; justify-content:center; text-align:center; }
    .hero-inner { max-width: 1000px; animation: fadeInUp .8s ease both; }
    .hero h1 { font-family: var(--font-heading); font-size: clamp(2rem, 5vw, 3.25rem); font-weight: 900; line-height: 1.15; margin-bottom: .75rem; background: linear-gradient(135deg, var(--neon-purple), var(--neon-cyan), var(--neon-magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; filter: drop-shadow(0 0 18px rgba(168,85,247,.55)); }
    .hero p { color: var(--text-secondary); font-size: clamp(1rem, 1.7vw, 1.125rem); }

    /* Search + Filters */
    .controls { max-width: 1200px; margin: 2rem auto 1rem; padding: 1.25rem; border-radius: 16px; }
    .search-row { display: grid; grid-template-columns: 1fr auto; gap: .75rem; align-items: center; }
    .search-input { width: 100%; padding: 1rem 1.25rem; border-radius: 999px; border: 2px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); outline: none; transition: all .25s ease; }
    .search-input::placeholder { color: var(--text-secondary); }
    .search-input:focus { border-color: var(--neon-cyan); box-shadow: 0 0 0 4px rgba(34,211,238,.15), inset 0 0 18px rgba(34,211,238,.08); transform: scale(1.01); }
    .btn { position: relative; display: inline-flex; align-items: center; justify-content: center; gap:.5rem; padding: .9rem 1.25rem; border-radius: 999px; border: 0; font-weight: 600; cursor: pointer; transition: all .25s ease; text-decoration: none; }
    .btn-primary { color: var(--text-primary); background: linear-gradient(135deg, var(--primary-purple), var(--primary-cyan)); box-shadow: 0 12px 28px rgba(139,92,246,.25), inset 0 1px 0 rgba(255,255,255,.18); }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 18px 40px rgba(139,92,246,.35), 0 0 36px rgba(34,211,238,.25); }
    .btn-secondary { color: var(--text-primary); background: var(--glass-bg); border: 1px solid var(--glass-border); }
    .btn-secondary:hover { transform: translateY(-2px); border-color: var(--neon-cyan); box-shadow: 0 0 22px rgba(34,211,238,.25); }

    .filters { display: grid; grid-template-columns: repeat(12, 1fr); gap: .75rem; margin-top: .9rem; }
    .filter { grid-column: span 3; }
    .filter.full { grid-column: 1 / -1; }
    .select, .input, .range { width: 100%; padding: .8rem 1rem; border-radius: 12px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); outline: none; transition: border .2s ease; }
    .select:focus, .input:focus, .range:focus { border-color: var(--neon-cyan); }

    .chips { display: flex; flex-wrap: wrap; gap: .5rem; }
    .chip { padding: .45rem .75rem; border-radius: 999px; font-size: .9rem; border: 1px solid var(--glass-border); color: var(--text-secondary); background: rgba(255,255,255,.04); cursor: pointer; transition: all .2s ease; user-select: none; }
    .chip:hover { border-color: var(--neon-cyan); color: var(--text-primary); box-shadow: 0 0 18px rgba(34,211,238,.2); }
    .chip.active { background: linear-gradient(135deg, rgba(168,85,247,.35), rgba(34,211,238,.35)); color: var(--text-primary); border-color: transparent; }

    .results-bar { max-width: 1200px; margin: 0.75rem auto 0; display:flex; align-items:center; justify-content: space-between; gap:1rem; color: var(--text-secondary); }
    .sort-select { padding: .6rem .9rem; border-radius: 10px; border: 1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); }

    /* Job list */
    .list-wrap { max-width: 1200px; margin: 1rem auto 4rem; display:grid; grid-template-columns: 1fr; gap: 1rem; }
    .job { position: relative; border-radius: 18px; padding: 1.25rem; display:grid; grid-template-columns: 1fr auto; gap: 1rem; align-items: start; transition: transform .2s ease, box-shadow .2s ease; cursor: default; }
    .job:hover { transform: translateY(-4px); box-shadow: 0 22px 60px rgba(139,92,246,.18), 0 0 32px rgba(34,211,238,.16); }
    .job h3 { font-size: 1.125rem; margin-bottom:.25rem; font-weight: 700; }
    .meta { display:flex; flex-wrap:wrap; gap:.6rem 1rem; color: var(--text-secondary); font-size: .95rem; }
    .tags { display:flex; flex-wrap:wrap; gap:.45rem; margin-top:.6rem; }
    .tag { font-size: .8rem; border: 1px solid var(--glass-border); padding: .28rem .55rem; border-radius: 999px; color: var(--text-secondary); background: rgba(255,255,255,.04); }
    .job-actions { display:flex; gap:.5rem; align-items:center; }
    .save-btn { min-width: 44px; height:44px; border-radius: 999px; border:1px solid var(--glass-border); background: var(--glass-bg); color: var(--text-primary); cursor:pointer; }
    .save-btn[aria-pressed="true"] { border-color: transparent; background: linear-gradient(135deg, rgba(168,85,247,.35), rgba(34,211,238,.35)); }
    .desc { margin-top:.6rem; color: var(--text-secondary); }

    /* Pagination */
    .pagination { display:flex; gap:.5rem; justify-content:center; margin-top: 1rem; }
    .page-btn { padding:.6rem .9rem; border-radius: 10px; border:1px solid var(--glass-border); background: var(--glass-bg); color:var(--text-primary); cursor:pointer; }
    .page-btn[aria-current="page"] { background: linear-gradient(135deg, rgba(168,85,247,.35), rgba(34,211,238,.35)); border-color: transparent; }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.5); z-index: 2000; }
    .modal { width:min(720px, 92vw); border-radius: 16px; padding: 1.25rem; }
    .modal header { display:flex; justify-content: space-between; align-items: start; gap: .75rem; }
    .close-x { background:none; border:0; color:var(--text-secondary); font-size:1.6rem; cursor:pointer; }

    /* Footer */
    footer { border-top: 1px solid var(--glass-border); padding: 2rem 1rem; color: var(--text-secondary); text-align:center; }

    /* Animations */
    @keyframes fadeInUp { from{ opacity: 0; transform: translateY(12px)} to{ opacity: 1; transform: translateY(0)} }

    /* Responsive */
    @media (max-width: 900px){
      .filters { grid-template-columns: 1fr 1fr; }
      .filter { grid-column: span 1; }
      .job { grid-template-columns: 1fr; }
      .results-bar { flex-direction: column; align-items: flex-start; }
    }
    @media (max-width: 640px){
      .nav-links { display:none; }
      .mobile-menu-btn { display:block; }
      .filters { grid-template-columns: 1fr; }
      .controls { padding: .9rem; }
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce){
      * { animation-duration: .001ms !important; animation-iteration-count: 1 !important; transition-duration: .001ms !important; }
      .bg-animation { animation: none; }
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>

  <!-- NAVBAR -->
  <nav class="navbar" id="navbar">
    <div class="nav-wrap">
      <a class="logo" href="index.html">CareerCompass</a>
      <ul class="nav-links">
        <li><a href="index.html#home">Home</a></li>
        <li><a href="index.html#features">Features</a></li>
        <li><a class="active" href="#">Jobs</a></li>
        <li><a href="index.html#about">About</a></li>
        <li><a href="index.html#contact">Contact</a></li>
      </ul>
      <button class="mobile-menu-btn" id="menuBtn" aria-label="Open menu">☰</button>
    </div>
  </nav>

  <!-- HERO -->
  <section class="hero" aria-labelledby="jobs-title">
    <div class="hero-inner">
      <h1 id="jobs-title">Explore Curated Roles Tailored by AI</h1>
      <p>Search, filter, and track opportunities across languages and locations. Save jobs you love and apply when ready.</p>
    </div>
  </section>

  <!-- CONTROLS -->
  <section class="controls glass" aria-label="Search and filters">
    <div class="search-row">
      <input id="searchInput" class="search-input" type="search" placeholder="Search roles, companies, skills… (e.g., React, Data Analyst)" aria-label="Search jobs" />
      <button id="searchBtn" class="btn btn-primary" aria-label="Search jobs">Search</button>
    </div>

    <div class="filters">
      <div class="filter">
        <label for="locInput" class="sr-only">Location</label>
        <input id="locInput" class="input" type="text" placeholder="Location (e.g., Berlin, Remote)" />
      </div>
      <div class="filter">
        <label for="typeSelect" class="sr-only">Job type</label>
        <select id="typeSelect" class="select">
          <option value="">Any type</option>
          <option>Full-time</option>
          <option>Part-time</option>
          <option>Contract</option>
          <option>Internship</option>
          <option>Remote</option>
          <option>Hybrid</option>
        </select>
      </div>
      <div class="filter">
        <label for="salaryRange" style="display:block; color:var(--text-secondary); margin:0 0 .35rem .25rem">Min salary (USD)</label>
        <input id="salaryRange" class="range" type="range" min="0" max="250000" step="5000" value="0" />
        <div style="margin-top:.35rem; color:var(--text-secondary)"><span id="salaryValue">$0</span>+</div>
      </div>
      <div class="filter">
        <label for="sortSelect" class="sr-only">Sort</label>
        <select id="sortSelect" class="select">
          <option value="relevant">Sort: Most relevant</option>
          <option value="date">Newest</option>
          <option value="salary">Highest salary</option>
          <option value="company">Company A→Z</option>
        </select>
      </div>
      <div class="filter full">
        <div class="chips" id="chipRow" aria-label="Quick filters">
          <!-- chips injected -->
        </div>
      </div>
    </div>
  </section>

  <div class="results-bar" aria-live="polite">
    <div id="resultsCount">Loading jobs…</div>
    <div style="display:flex; gap:.5rem; align-items:center">
      <button id="clearBtn" class="btn btn-secondary" aria-label="Clear filters">Clear filters</button>
      <label for="sortSelect" class="sr-only">Sort</label>
      <select id="sortSelectClone" class="sort-select" aria-label="Sort results">
        <option value="relevant">Most relevant</option>
        <option value="date">Newest</option>
        <option value="salary">Highest salary</option>
        <option value="company">Company A→Z</option>
      </select>
    </div>
  </div>

  <!-- JOB LIST -->
  <main class="list-wrap" id="list" aria-label="Job results"></main>
  <nav class="pagination" id="pagination" aria-label="Pagination"></nav>

  <!-- MODAL -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal glass" role="document">
      <header>
        <h2 id="modalTitle" style="font-family:var(--font-heading); font-size:1.25rem"></h2>
        <button class="close-x" id="modalClose" aria-label="Close">×</button>
      </header>
      <p id="modalMeta" style="color:var(--text-secondary); margin:.5rem 0 1rem"></p>
      <div id="modalBody" style="white-space:pre-line; color:var(--text-primary)"></div>
      <div style="display:flex; gap:.5rem; margin-top:1rem; justify-content:flex-end">
        <button class="btn btn-secondary" id="modalSave">Save</button>
        <a class="btn btn-primary" id="modalApply" href="#" target="_blank" rel="noopener">Apply Now</a>
      </div>
    </div>
  </div>

  <footer>
    <p>© <span id="year"></span> CareerCompass. Crafted with ✨ gradients and a lot of care.</p>
  </footer>

  <style>
    /* tiny util for screen reader text */
    .sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0; }
  </style>

  <script>
    // ======= DATA (sample jobs) =======
    const JOBS = [
      { id: '1', title: 'Frontend Engineer (React)', company: 'NovaSoft', location: 'Berlin, DE', type: 'Full-time', salary: 115000, posted: '2025-08-01', remote: 'Hybrid', tags: ['React', 'TypeScript', 'UI'], lang: ['EN','DE'], apply: '#', description: 'Build highly performant interfaces with React + TypeScript. Work closely with design to deliver pixel-perfect experiences. Experience with testing and accessibility a plus.' },
      { id: '2', title: 'Data Analyst', company: 'Aether Analytics', location: 'Remote', type: 'Full-time', salary: 90000, posted: '2025-07-28', remote: 'Remote', tags: ['SQL', 'Tableau', 'Python'], lang: ['EN','ES'], apply: '#', description: 'Own dashboards and insights used by global stakeholders. Comfortable with SQL, data modeling, and communicating findings.' },
      { id: '3', title: 'Machine Learning Engineer', company: 'Quantica Labs', location: 'Toronto, CA', type: 'Full-time', salary: 150000, posted: '2025-07-20', remote: 'Hybrid', tags: ['ML', 'PyTorch', 'MLOps'], lang: ['EN'], apply: '#', description: 'Productionize models for real-time inference. Collaborate with infra to scale services. Knowledge of MLOps best practices required.' },
      { id: '4', title: 'Product Designer', company: 'Orbital', location: 'London, UK', type: 'Contract', salary: 70000, posted: '2025-07-26', remote: 'Hybrid', tags: ['Figma', 'UX', 'Prototyping'], lang: ['EN'], apply: '#', description: 'Lead end‑to‑end product design across web and mobile. Strong portfolio demonstrating design systems and prototyping.' },
      { id: '5', title: 'Backend Engineer (Node.js)', company: 'Helios Cloud', location: 'Austin, US', type: 'Full-time', salary: 130000, posted: '2025-08-05', remote: 'Remote', tags: ['Node.js', 'PostgreSQL', 'AWS'], lang: ['EN'], apply: '#', description: 'Design and maintain microservices in Node.js. Experience with relational databases and AWS services preferred.' },
      { id: '6', title: 'Localization Specialist', company: 'Polyglot Inc.', location: 'Barcelona, ES', type: 'Part-time', salary: 48000, posted: '2025-07-18', remote: 'Hybrid', tags: ['Translation', 'QA', 'CAT Tools'], lang: ['ES','EN'], apply: '#', description: 'Ensure high‑quality translations and consistency across languages. Familiarity with CAT tools required.' },
      { id: '7', title: 'DevOps Engineer', company: 'StreamForge', location: 'Bengaluru, IN', type: 'Full-time', salary: 98000, posted: '2025-07-30', remote: 'Hybrid', tags: ['Kubernetes', 'CI/CD', 'Terraform'], lang: ['EN'], apply: '#', description: 'Scale infra with Kubernetes and IaC. Improve CI/CD pipelines and observability.' },
      { id: '8', title: 'iOS Developer', company: 'PocketWorks', location: 'Remote', type: 'Contract', salary: 100000, posted: '2025-07-12', remote: 'Remote', tags: ['Swift', 'SwiftUI', 'Xcode'], lang: ['EN'], apply: '#', description: 'Ship delightful iOS apps using SwiftUI. Strong knowledge of Apple HIG and async patterns.' },
      { id: '9', title: 'Content Strategist (Multilingual)', company: 'Voyager Media', location: 'Paris, FR', type: 'Full-time', salary: 80000, posted: '2025-07-22', remote: 'Hybrid', tags: ['Content', 'SEO', 'French'], lang: ['FR','EN'], apply: '#', description: 'Plan and execute content strategy across French + English markets. Collaborate with growth and design.' },
      { id: '10', title: 'Security Engineer', company: 'Sentinel', location: 'New York, US', type: 'Full-time', salary: 160000, posted: '2025-07-16', remote: 'Onsite', tags: ['Security', 'Threat Modeling', 'AppSec'], lang: ['EN'], apply: '#', description: 'Harden application stack and run threat modeling exercises. Experience with SAST/DAST tools.' },
      { id: '11', title: 'Android Engineer', company: 'Orbit Apps', location: 'Remote', type: 'Full-time', salary: 120000, posted: '2025-08-07', remote: 'Remote', tags: ['Kotlin', 'Compose', 'Coroutines'], lang: ['EN'], apply: '#', description: 'Build Android apps with Kotlin + Compose. Work closely with backend to shape APIs.' },
      { id: '12', title: 'Business Analyst (Japanese)', company: 'Sakura Tech', location: 'Tokyo, JP', type: 'Full-time', salary: 110000, posted: '2025-07-10', remote: 'Hybrid', tags: ['BA', 'Agile', 'Japanese'], lang: ['JA','EN'], apply: '#', description: 'Bridge business needs and tech delivery. Fluent Japanese required; experience in agile ceremonies preferred.' }
    ];

    const QUICK_CHIPS = ['Remote', 'Hybrid', 'Entry', 'Senior', 'AI/ML', 'Design', 'Mobile', 'Cloud', 'Security'];

    // ======= STATE =======
    const state = {
      q: '',
      location: '',
      type: '',
      minSalary: 0,
      chips: new Set(),
      sort: 'relevant',
      page: 1,
      perPage: 8,
      saved: new Set(JSON.parse(localStorage.getItem('savedJobs') || '[]')),
    };

    // ======= DOM =======
    const $ = sel => document.querySelector(sel);
    const list = $('#list');
    const resultsCount = $('#resultsCount');
    const pagination = $('#pagination');
    const searchInput = $('#searchInput');
    const searchBtn = $('#searchBtn');
    const locInput = $('#locInput');
    const typeSelect = $('#typeSelect');
    const salaryRange = $('#salaryRange');
    const salaryValue = $('#salaryValue');
    const clearBtn = $('#clearBtn');
    const sortSelect = $('#sortSelect');
    const sortSelectClone = $('#sortSelectClone');
    const chipRow = $('#chipRow');

    // Modal
    const modalBackdrop = $('#modalBackdrop');
    const modalClose = $('#modalClose');
    const modalTitle = $('#modalTitle');
    const modalMeta = $('#modalMeta');
    const modalBody = $('#modalBody');
    const modalApply = $('#modalApply');
    const modalSave = $('#modalSave');

    // ======= HELPERS =======
    const fmt = new Intl.NumberFormat('en-US');
    const parseQuery = () => new URLSearchParams(location.search);

    function debounce(fn, delay=300){ let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay) }; }

    function normalize(str){ return (str||'').toString().toLowerCase(); }

    function chipMarkup(label){ return `<button class="chip" data-chip="${label}">${label}</button>` }

    function tagMarkup(label){ return `<span class="tag">${label}</span>` }

    function jobCard(job){
      const saved = state.saved.has(job.id);
      return `
      <article class="job glass" data-id="${job.id}">
        <div>
          <h3>${job.title}</h3>
          <div class="meta">
            <span>${job.company}</span>
            <span>• ${job.location}</span>
            <span>• ${job.type}${job.remote && job.remote!=='Onsite' ? ` · ${job.remote}`:''}</span>
            <span>• $${fmt.format(job.salary)} USD</span>
            <span>• Posted ${new Date(job.posted).toLocaleDateString()}</span>
          </div>
          <div class="tags">${job.tags.map(tagMarkup).join('')}</div>
          <p class="desc">${job.description}</p>
        </div>
        <div class="job-actions">
          <button class="save-btn" aria-pressed="${saved}" aria-label="Save job">${saved ? '★' : '☆'}</button>
          <a class="btn btn-primary" href="#" data-apply="${job.id}">Apply</a>
        </div>
      </article>`
    }

    // ======= FILTERING =======
    function applyFilters(){
      const q = normalize(state.q);
      const loc = normalize(state.location);
      const type = state.type;
      const chipSet = state.chips;

      let results = JOBS.filter(j => {
        const searchable = [j.title, j.company, j.description, ...(j.tags||[])].join(' ');
        if(q && !normalize(searchable).includes(q)) return false;
        if(loc && !normalize(j.location).includes(loc)) return false;
        if(type && !(j.type===type || j.remote===type)) return false; // allow "Remote"/"Hybrid" through typeSelect
        if(state.minSalary && (j.salary||0) < state.minSalary) return false;
        if(chipSet.size){
          // Basic chip logic: matches if any chip keyword appears in title/tags/remote
          const target = normalize([j.title, j.remote, ...(j.tags||[])].join(' '));
          let ok = false;
          chipSet.forEach(c => { if(target.includes(normalize(c))) ok = true; });
          if(!ok) return false;
        }
        return true;
      });

      // Sorting
      switch(state.sort){
        case 'date': results.sort((a,b)=> new Date(b.posted)-new Date(a.posted)); break;
        case 'salary': results.sort((a,b)=> (b.salary||0)-(a.salary||0)); break;
        case 'company': results.sort((a,b)=> a.company.localeCompare(b.company)); break;
        default: // relevant – simple heuristic
          results.sort((a,b)=> score(b)-score(a));
      }

      function score(j){
        let s = 0;
        if(state.q){ s += (normalize(j.title).includes(q)?5:0) + (normalize(j.description).includes(q)?2:0); }
        if(state.type && (j.type===state.type || j.remote===state.type)) s += 1;
        if(state.location && normalize(j.location).includes(loc)) s += 1;
        if(state.minSalary && (j.salary||0) >= state.minSalary) s += 1;
        if(state.chips.size){ const t = normalize([j.title, ...(j.tags||[])].join(' ')); state.chips.forEach(c=>{ if(t.includes(normalize(c))) s+=1; }); }
        return s;
      }

      return results;
    }

    function render(){
      const results = applyFilters();
      const total = results.length;
      resultsCount.textContent = `${total} job${total!==1?'s':''} found`;

      // Pagination
      const pages = Math.max(1, Math.ceil(total / state.perPage));
      if(state.page > pages) state.page = pages;
      const start = (state.page - 1) * state.perPage;
      const slice = results.slice(start, start + state.perPage);

      list.innerHTML = slice.map(jobCard).join('');

      // Bind actions
      list.querySelectorAll('.job').forEach(card => {
        const id = card.getAttribute('data-id');
        card.addEventListener('click', e => {
          // open modal unless clicking save/apply
          const isButton = e.target.closest('button, a');
          if(isButton) return;
          openModal(id);
        });
        card.querySelector('.save-btn').addEventListener('click', e => {
          e.stopPropagation();
          toggleSave(id, e.currentTarget);
        });
        card.querySelector('[data-apply]')?.addEventListener('click', e => {
          e.preventDefault(); e.stopPropagation();
          openModal(id); // open modal to confirm
        });
      });

      // Pagination UI
      pagination.innerHTML = '';
      const createBtn = (label, page, attrs={}) => {
        const btn = document.createElement('button');
        btn.className = 'page-btn glass';
        btn.textContent = label;
        if(attrs.current){ btn.setAttribute('aria-current','page'); btn.disabled = true; }
        btn.addEventListener('click', ()=>{ state.page = page; window.scrollTo({ top: 0, behavior: 'smooth' }); render(); });
        return btn;
      };
      if(pages>1){
        if(state.page>1) pagination.append(createBtn('‹ Prev', state.page-1));
        for(let p=1; p<=pages; p++) pagination.append(createBtn(String(p), p, { current: p===state.page }));
        if(state.page<pages) pagination.append(createBtn('Next ›', state.page+1));
      }

      // Sync saved star state during re-render
      list.querySelectorAll('.job .save-btn').forEach(btn => {
        const id = btn.closest('.job').dataset.id;
        const saved = state.saved.has(id);
        btn.setAttribute('aria-pressed', saved);
        btn.textContent = saved ? '★' : '☆';
      });
    }

    function toggleSave(id, el){
      if(state.saved.has(id)) state.saved.delete(id); else state.saved.add(id);
      localStorage.setItem('savedJobs', JSON.stringify([...state.saved]));
      if(el){ el.setAttribute('aria-pressed', state.saved.has(id)); el.textContent = state.saved.has(id) ? '★' : '☆'; }
    }

    // ======= MODAL =======
    function openModal(id){
      const job = JOBS.find(j=>j.id===id);
      if(!job) return;
      modalTitle.textContent = `${job.title} — ${job.company}`;
      modalMeta.textContent = `${job.location} • ${job.type}${job.remote && job.remote!=='Onsite'?` · ${job.remote}`:''} • $${fmt.format(job.salary)} • Posted ${new Date(job.posted).toLocaleDateString()}`;
      modalBody.textContent = job.description + '\n\nSkills: ' + (job.tags||[]).join(', ');
      modalApply.href = job.apply || '#';
      modalSave.onclick = () => toggleSave(job.id);
      modalBackdrop.style.display = 'flex';
      modalBackdrop.setAttribute('aria-hidden','false');
      document.body.style.overflow = 'hidden';
      modalClose.focus();
    }
    function closeModal(){
      modalBackdrop.style.display = 'none';
      modalBackdrop.setAttribute('aria-hidden','true');
      document.body.style.overflow = '';
    }

    // ======= INIT =======
    function init(){
      // navbar scrolled
      const navbar = document.getElementById('navbar');
      const onScroll = ()=> navbar.classList.toggle('scrolled', window.scrollY>10);
      window.addEventListener('scroll', onScroll); onScroll();

      // mobile menu (very simple)
      const menuBtn = document.getElementById('menuBtn');
      menuBtn?.addEventListener('click', ()=> alert('For this demo, use the desktop nav links.'));

      // chips
      chipRow.innerHTML = QUICK_CHIPS.map(chipMarkup).join('');
      chipRow.addEventListener('click', e => {
        const btn = e.target.closest('.chip'); if(!btn) return;
        const label = btn.dataset.chip; if(state.chips.has(label)) state.chips.delete(label); else state.chips.add(label);
        btn.classList.toggle('active'); state.page = 1; render();
      });

      // link inputs to state (debounced)
      const sync = debounce(()=>{ state.q = searchInput.value.trim(); state.location = locInput.value.trim(); state.page=1; render(); });
      searchInput.addEventListener('input', sync);
      locInput.addEventListener('input', sync);
      searchBtn.addEventListener('click', ()=>{ state.q = searchInput.value.trim(); state.page=1; render(); });
      typeSelect.addEventListener('change', ()=>{ state.type = typeSelect.value; state.page=1; render(); });
      salaryRange.addEventListener('input', ()=>{ state.minSalary = Number(salaryRange.value); salaryValue.textContent = `$${fmt.format(state.minSalary)}`; state.page=1; render(); });
      sortSelect.addEventListener('change', ()=>{ state.sort = sortSelect.value; sortSelectClone.value = state.sort; render(); });
      sortSelectClone.addEventListener('change', ()=>{ state.sort = sortSelectClone.value; sortSelect.value = state.sort; render(); });
      clearBtn.addEventListener('click', ()=>{ state.q=''; state.location=''; state.type=''; state.minSalary=0; state.chips.clear(); state.sort='relevant'; state.page=1; savedSync(); render(); });

      // pull query from URL (?q=...)
      const params = parseQuery();
      if(params.has('q')){ state.q = params.get('q'); searchInput.value = state.q; }

      salaryValue.textContent = `$${fmt.format(state.minSalary)}`;
      document.getElementById('year').textContent = new Date().getFullYear();

      render();

      // Modal bindings
      modalClose.addEventListener('click', closeModal);
      modalBackdrop.addEventListener('click', e => { if(e.target===modalBackdrop) closeModal(); });
      window.addEventListener('keydown', e => { if(e.key==='Escape') closeModal(); });
    }

    function savedSync(){
      // reset UI inputs when clearing
      searchInput.value=''; locInput.value=''; typeSelect.value=''; salaryRange.value='0'; salaryValue.textContent='$0';
      chipRow.querySelectorAll('.chip.active').forEach(c=>c.classList.remove('active'));
      sortSelect.value='relevant'; sortSelectClone.value='relevant';
    }

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
